rem %1 - значение первого аргумента командной строки bat-файла (какой он есть)
rem %~1 - значение первого аргумента командной строки bat-файла с удалением обрамл€ющих кавычек (если они были)

rem ѕеременна€ PROGRAM будет хранить первый аргумент командной строки заключЄнный в кавычки
set PROGRAM="%~1"
set PATH_TEST="test-files"

rem провер€ем неверное количество аргументов
%PROGRAM% %PATH_TEST%\one-line.txt > %TEMP%/output.txt
if NOT ERRORLEVEL 1 goto err
fc.exe %TEMP%\output.txt %PATH_TEST%\invalid-arguments-count.txt
if ERRORLEVEL 1 goto err

rem провер€ем копирование пустого файла (копируем его во временную папку текущего пользовател€)
%PROGRAM% %PATH_TEST%\empty.txt %TEMP%\empty.txt
if ERRORLEVEL 1 goto err
fc.exe %TEMP%\empty.txt %PATH_TEST%\empty.txt
if ERRORLEVEL 1 goto err

rem провер€ем копирование файла из одной строки
%PROGRAM% %PATH_TEST%\one-line.txt %TEMP%\one-line.txt
if ERRORLEVEL 1 goto err
fc.exe %TEMP%\one-line.txt %PATH_TEST%\one-line.txt
if ERRORLEVEL 1 goto err

rem провер€ем копирование файла из нескольких строк
%PROGRAM% %PATH_TEST%\multiline.txt %TEMP%\multiline.txt
if ERRORLEVEL 1 goto err
fc.exe %TEMP%\multiline.txt %PATH_TEST%\multiline.txt
if ERRORLEVEL 1 goto err

rem ожидаем ненулевой код ошибки при копировании несуществующего файла
%PROGRAM% %PATH_TEST%\non-existing-file-name.txt %TEMP%\non-existing-file-name.txt > %TEMP%\output.txt
if NOT ERRORLEVEL 1 goto err
fc.exe %TEMP%\output.txt %PATH_TEST%\failed-to-open-read.txt
if ERRORLEVEL 1 goto err

rem ожидаем ненулевой код ошибки при невозможности записи в выходной файл (в исполн€емый файл программы)
%PROGRAM% %PATH_TEST%\multiline.txt %PROGRAM% > %TEMP%\output.txt
if NOT ERRORLEVEL 1 goto
fc.exe %TEMP%\output.txt %PATH_TEST%\failed-to-open-write.txt
if ERRORLEVEL 1 goto err

echo Program testing succeeded
exit 0

:err
echo Program testing failed
exit 1